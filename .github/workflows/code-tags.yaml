name: Test and merge to dev
on:
  push:
    branches:
      - "feat/*"
      - "fix/*"
      - "perf/*"
      - "build/*"
      - "style/*"
      - "refactor/*"
      - "test/*"

permissions:
  id-token: write # This is required for requesting the JWT
  contents: write  # This is required for actions/checkout
jobs:
  run-tests:
    uses: ./.github/workflows/run-tests.yaml
    if: false
    secrets: inherit
    permissions:
      id-token: write
      contents: read

#  create-pr:
#    runs-on: ubuntu-latest
#    needs: run-tests
#    steps:
#      - name: Check out repository
#        uses: actions/checkout@v3

  create-pr:
    runs-on: ubuntu-latest
    needs: run-tests
    steps:
      - uses: actions/checkout@v3
      - name: Create Pull Request
        id: ci-pr
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GH_PAT }}
          commit-message: AUTO - ${{ github.ref }}
          committer: GitHub <noreply@github.com>
          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
          branch: main
          base: ${{ github.ref }}
          title: AUTO PR - ${{ github.ref }}
          body: |
            Tests successfully passed, this code doesn't break anything.
          labels: |
            automated pr
