name: Test and submit PR to main
on:
  push:
    branches:
      - dev
permissions:
  id-token: write # This is required for requesting the JWT
  contents: write  # This is required for actions/checkout
jobs:
  run-tests:
    uses: ./.github/workflows/run-tests.yaml
    secrets: inherit
    permissions:
        id-token: write
        contents: read
    with:
      tag: ${{ github.ref_name }}

  create-pr:
    runs-on: ubuntu-latest
    needs: run-tests
    steps:
      - name: Check out repository
        uses: actions/checkout@v3

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          title: GH Actions auto-release üêç
          committer: GitHub Actions <samuelvange@gmail.com>
          branch: dev
          base: main

#
#


  # if not on dev or master, and tag is "feat", "fix", "perf", "build", "ci"
  # merge and push to dev
#  update-git-dev:
#    runs-on: ubuntu-latest
#    needs: publish-test
#    if: startsWith(github.context.commit.message, 'fix:') or startsWith(github.context.commit.message, 'feat:') or startsWith(github.context.commit.message, 'perf:') or startsWith(github.context.commit.message, 'build:') or startsWith(github.context.commit.message, 'ci:')
#    steps:
#      - uses: actions/checkout@v3
#        with:
#          ref: ${{ github.head_ref }}
#          fetch-depth: 0
#      - name: Git operations to merge and push to dev
#        run: |
#          git config --local user.email "github-actions[bot]@users.noreply.github.com"
#          git config --local user.name "github-actions[bot]"
#          git fetch
#          git rebase origin/dev
#          git checkout dev
#          git pull origin dev
#          git merge --no-ff ${{ github.head_ref }}
#          git commit -a -m "github-actions[bot] - ${{ github.ref_name }} - ${{ github.sha }}"
#      - name: Push changes
#        uses: ad-m/github-push-action@master
#        with:
#          branch: dev
